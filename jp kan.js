/* æ¨å°æ—¥æœ¬èªæ¼¢éŸ³èˆŠ
 *
 * ä»¥å­—éŸ³å‡åé£å½¢å¼è¡¨ç¤ºï¼Œæ‹—éŸ³ç”¨å°æ‡‰å°å‡åè¡¨ç¤ºï¼›æœ‰é¸é …å¯æ§åˆ¶ï¼šåˆ†mnå°¾ã€ã‚ã‚‘åˆæ‹—éŸ³ã€ã‚ã‚‘å°å‡åã€ç‹‚ï¼šã‚¯ğ›…¥ãƒ£ã‚¦ï¼ã‚­ãƒ£ã‚¦
 *
 * https://jgrammar.life.coocan.jp/ja/data/ksound.htm
 * https://ksu.repo.nii.ac.jp/record/1280/files/AHSUSK_HS_37_133.pdf
 *
 * å·²çŸ¥å•é¡Œï¼š
 *
 */

/** @type { éŸ³éŸ»åœ°ä½['å±¬æ–¼'] } */
const is = (...x) => éŸ³éŸ»åœ°ä½.å±¬æ–¼(...x);
/** @type { éŸ³éŸ»åœ°ä½['åˆ¤æ–·'] } */
const when = (...x) => éŸ³éŸ»åœ°ä½.åˆ¤æ–·(...x);

// const é¸é … = {};
  // å‡åå¯«æ³•
// é¸é ….å‡å = true; // é–‹ï¼šã‚«ãƒ³ã€€é—œï¼škan
// é¸é ….å°å‡å = true; // é–‹ï¼šã‚­ãƒ£ã‚¦ã€€é—œï¼šã‚­ãƒ¤ã‚¦
// é¸é ….å°å‡åã‚ã‚‘ = true; // é–‹ï¼šã‚¯ğ›…¥ãƒ³ã€€é—œï¼šã‚¯ãƒ±ãƒ³
// if (!é¸é ….å°å‡å)
//    é¸é ….å°å‡åã‚ã‚‘ = false;
  // éŸ³è®Šè¦å‰‡
// é¸é ….ã¢ã¥ = true; // é–‹ï¼šã¢ã¥ã€€é—œï¼šã˜ãš
// é¸é ….ã‚ãŠæ®µåˆå£ = true; // é–‹ï¼šãã‚ã€ã‚ã€€é—œï¼šã‹ã€ã‚
// é¸é ….ã„ãˆæ®µåˆå£ = true; // é–‹ï¼šã‚¯ğ›…¥ãƒ³ã€€é—œï¼šã‚±ãƒ³
// é¸é ….åˆ†mnå°¾ = true; // é–‹ï¼šã‚«ãƒ ã€€é—œï¼šã‚«ãƒ³
// é¸é ….å°å‡åÅ‹å°¾ = false; // é–‹ï¼šã‚«ã‚¥ã€€é—œï¼šã‚«ã‚¦
// é¸é ….på°¾ = true; // é–‹ï¼šã‹ãµã€€é—œï¼šã‹ã†
// é¸é ….åˆ†uå°¾éŸ» = true; // é–‹ï¼šã‚ã†ã€ãˆã†ã€€é—œï¼šãŠã†ã€ã‚ˆã†

function è²æ¯è¦å‰‡() {
  return when([
    ['æ˜æ¯', [['æ¢—æ” èˆ’è²', 'm'], ['', 'b']]],
    ['è„£éŸ³', 'f'],

    ['æ³¥å­ƒæ¯', [['æ¢—æ”', 'n'], ['', 'd']]],
    ['ä¾†æ¯', 'r'],
    ['èˆŒéŸ³', 't'],

    ['æ—¥æ¯', 'z'],
    ['é½’éŸ³', 's'],

    ['ç–‘æ¯', 'g'],
    ['å½±äº‘ä»¥æ¯', '0'],
    ['ç‰™å–‰éŸ³', 'k'],
  ], 'ç„¡è²æ¯è¦å‰‡');
}

function éŸ»æ¯è¦å‰‡() {
  return when([
	// æœå‡æ”
    ['æœå‡æ”', [['åˆå£', 'wa'], ['ä¸€äºŒç­‰ æˆ– è„£éŸ³ æœæ”', 'a'], ['', 'ya']]],
	// é‡æ”
    ['æ¨¡éŸ»', [['å½±æ¯', 'wo'], ['', 'o']]], // æ±š wo
    ['é­šéŸ»', [['èŠçµ„', 'o'], ['', 'yo']]],
    ['è™éŸ»', [['å¹«èŠè¦‹å½±çµ„ æˆ– ä¾†æ¯', 'u'], ['çŸ¥çµ„', 'yuu'], ['', 'yu']]],
	// èŸ¹æ”
    ['ç¥­é½ŠéŸ»', [['åˆå£', 'wei'], ['', 'ei']]],
    ['èŸ¹æ”', [['åˆå£', 'wai'], ['', 'ai']]],
	// æ­¢æ”
    ['æ­¢æ” åˆå£', [['èˆŒé½’éŸ³', 'ui'], ['ç‰™å–‰éŸ³', 'wi']]], // æ°´ ã™ã„ï½œé¡ ã‚‹ã„ï½œå° ã¤ã„
    ['æ­¢æ”', 'i'],
	// æ•ˆæ”
    ['è±ªéŸ» è„£éŸ³', 'ou'],
    ['è±ªè‚´éŸ»', 'au'],
    ['å®µè•­éŸ»', 'eu'],
	// æµæ”
    ['ä¾¯éŸ»', 'ou'],
    ['å°¤éŸ»', [['æ˜æ¯', 'ou'], ['è„£éŸ³', 'uu'], ['', 'iu']]],
    ['å¹½éŸ»', 'iu'],
	// å’¸æ”
    ['é¹½åš´æ·»éŸ»', 'em'],
    ['å’¸æ”', 'am'],
	// æ·±æ”
    ['æ·±æ”', 'im'],
	// å±±æ”
    ['å¯’åˆªå±±éŸ»', [['åˆå£', 'wan'], ['', 'an']]],
    ['å…ƒéŸ» è„£éŸ³', 'an'],
    ['å±±æ”', [['åˆå£', 'wen'], ['', 'en']]],
	// è‡»æ”
    ['ç—•é­‚éŸ»', 'on'],
    ['æ–‡éŸ»', 'un'],
    //['è«„éŸ» åˆå£', [['ä¾†æ¯ æˆ– Aé¡', 'in'], ['', 'yun']]],
    ['çœŸéŸ» åˆå£ é ä¾†æ¯', [['èŠçµ„', 'on'], ['èˆŒé½’éŸ³', 'yun'], ['', 'win']]],
    ['çœŸè‡»æ®·éŸ»', 'in'],
	// æ¢—æ”
    ['æ¢—æ” äºŒç­‰', [['åˆå£', 'waÅ‹'], ['', 'aÅ‹']]],
    ['æ¢—æ” åˆå£', 'weÅ‹'],
    ['æ¢—æ”', 'eÅ‹'],
	// æ›¾æ”
    ['ç™»éŸ»', 'oÅ‹'],
    ['è’¸éŸ»', [['åˆå£ ç‰™å–‰éŸ³ é äº‘æ¯', 'wyoÅ‹'], ['é–‹å£ èŠçµ„', 'oÅ‹'], ['', 'yoÅ‹']]],
	// å®•æ±Ÿæ”
    ['é™½éŸ» åˆå£', [['å½±äº‘æ¯', 'waÅ‹'], ['', 'wyaÅ‹']]],
    ['é™½éŸ»', [['å¹«èŠçµ„', 'aÅ‹'], ['', 'yaÅ‹']]],
    ['å®•æ±Ÿæ”', [['åˆå£', 'waÅ‹'], ['', 'aÅ‹']]],
	// é€šæ”
    ['æ±éŸ» ä¸€ç­‰ å½±æ¯', 'woÅ‹'], // ç¿
    ['æ±å†¬éŸ» ä¸€ç­‰', 'oÅ‹'],
    ['é¾éŸ»', [['è„£éŸ³', 'oÅ‹'], ['', 'yoÅ‹']]],
    ['æ±éŸ» è„£éŸ³', [['æ˜æ¯ æˆ– èˆ’è²','oÅ‹'], ['', 'uÅ‹']]],
    ['æ±éŸ» å½±æ¯ å…¥è²', 'wiÅ‹'],
    ['æ±éŸ» çŸ¥å½±çµ„ æˆ– æ—¥ä¾†ä»¥æ¯', 'iÅ‹'],
    ['æ±éŸ» è¦‹çµ„ å…¥è²', 'iÅ‹'],
    ['æ±éŸ»', 'yuÅ‹'],
  ], 'ç„¡éŸ»æ¯è¦å‰‡');
}

let è²æ¯ = è²æ¯è¦å‰‡();
let éŸ»æ¯ = éŸ»æ¯è¦å‰‡();

// == éŸ»å°¾è¦å‰‡ ==

var Å‹ = false;

// å…¥è²éŸ»å°¾
if (is`å…¥è²`) {
    å…¥è²éŸ»å°¾ = {
        'm': 'fu',
        'n': 'tu',
        'Å‹': éŸ»æ¯[éŸ»æ¯.length - 2] == 'e' ? 'ki' : 'ku'
    }
    éŸ»æ¯ = éŸ»æ¯.slice(0, -1) + å…¥è²éŸ»å°¾[éŸ»æ¯.slice(-1)]
}

// Å‹éŸ»å°¾
if (éŸ»æ¯.endsWith('Å‹')) {
    éŸ»æ¯ = éŸ»æ¯.slice(0, -1) + (['e', 'i'].includes(éŸ»æ¯[éŸ»æ¯.length - 2]) ? 'i': 'u');
    Å‹ = true;
}

// == éŸ»é ­è¦å‰‡ ==
if (éŸ»æ¯.startsWith('w') && is`éŠ³éŸ³ æˆ– æ”¯è„‚æ¸…éŸ» Aé¡`) éŸ»æ¯ = éŸ»æ¯.slice(1); // åˆå£

// == éŸ»æ¯è¦å‰‡ ==
if (éŸ»æ¯ == 'ii') éŸ»æ¯ = 'yuu';

// TODOï¼šè½‰å‡åå‰æ•´ç†ç¾…é¦¬å­—

function çµ„åˆè²éŸ»(è²æ¯, éŸ»æ¯) {
    if (!é¸é ….ã„ãˆæ®µåˆå£ && è²æ¯ != '0') éŸ»æ¯ = éŸ»æ¯.replace('wy', 'y').replace('wi', 'i').replace('we', 'e');
    if (!é¸é ….åˆ†mnå°¾ && éŸ»æ¯.endsWith('m')) éŸ»æ¯ = éŸ»æ¯.slice(0, -1) + 'n';
    if (!é¸é ….på°¾) éŸ»æ¯ = { afu: 'au', ifu: 'yuu', efu: 'eu' }[éŸ»æ¯] ?? éŸ»æ¯;
    if (é¸é ….åˆ†uå°¾éŸ» == false && éŸ»æ¯.endsWith('u')) éŸ»æ¯ = éŸ»æ¯.replace('au', 'ou').replace('iu', 'yuu').replace('eu', 'you');
    if (!é¸é ….ã‚ãŠæ®µåˆå£ && (è²æ¯ != '0' || éŸ»æ¯[1] != 'a')) éŸ»æ¯ = éŸ»æ¯.replace('w', '');
    if (!é¸é ….ã¢ã¥ && ['i', 'y'].includes(éŸ»æ¯[0]) && è²æ¯ == 'd') è²æ¯ = 'z';
    return [è²æ¯, éŸ»æ¯].join('');
}

function å‡ååŒ–(æ‹‰ä¸è½‰å¯«) {
    const äº”åéŸ³ = {
        '0': {'a': 'ã‚', 'i': 'ã„', 'u': 'ã†', 'e': 'ãˆ', 'o': 'ãŠ'},
        'k': {'a': 'ã‹', 'i': 'ã', 'u': 'ã', 'e': 'ã‘', 'o': 'ã“'},
        'g': {'a': 'ãŒ', 'i': 'ã', 'u': 'ã', 'e': 'ã’', 'o': 'ã”'},
        's': {'a': 'ã•', 'i': 'ã—', 'u': 'ã™', 'e': 'ã›', 'o': 'ã'},
        'z': {'a': 'ã–', 'i': 'ã˜', 'u': 'ãš', 'e': 'ãœ', 'o': 'ã'},
        't': {'a': 'ãŸ', 'i': 'ã¡', 'u': 'ã¤', 'e': 'ã¦', 'o': 'ã¨'},
        'd': {'a': 'ã ', 'i': 'ã¢', 'u': 'ã¥', 'e': 'ã§', 'o': 'ã©'},
        'n': {'a': 'ãª', 'i': 'ã«', 'u': 'ã¬', 'e': 'ã­', 'o': 'ã®'},
        'f': {'a': 'ã¯', 'i': 'ã²', 'u': 'ãµ', 'e': 'ã¸', 'o': 'ã»'},
        'b': {'a': 'ã°', 'i': 'ã³', 'u': 'ã¶', 'e': 'ã¹', 'o': 'ã¼'},
        'm': {'a': 'ã¾', 'i': 'ã¿', 'u': 'ã‚€', 'e': 'ã‚', 'o': 'ã‚‚'},
        'y': {'a': 'ã‚„', 'i': 'â—‹', 'u': 'ã‚†', 'e': 'ãˆ', 'o': 'ã‚ˆ'},
        'r': {'a': 'ã‚‰', 'i': 'ã‚Š', 'u': 'ã‚‹', 'e': 'ã‚Œ', 'o': 'ã‚'},
        'w': {'a': 'ã‚', 'i': 'ã‚', 'u': 'â—‹', 'e': 'ã‚‘', 'o': 'ã‚’'},
    };

    let [wi, we] = é¸é ….å°å‡åã‚ã‚‘ ? ['ğ›…', 'ğ›…‘'] : ['ã‚', 'ã‚‘'];

    const å°å‡å = {
        'y': {'a': 'ã‚ƒ', 'i': 'â—‹', 'u': 'ã‚…', 'e': 'â—‹', 'o': 'ã‚‡'},
        'w': {'a': 'ã‚', 'i': wi, 'u': 'â—‹', 'e': we, 'o': 'ğ›…’'},
    };

    if (!é¸é ….å°å‡å) {
        å°å‡å['y'] = äº”åéŸ³['y'];
        å°å‡å['w'] = äº”åéŸ³['w'];
    }

    // äºŒåˆæ‹—éŸ³ï¼šwyauâ†’ğ›…ã‚ƒã†
    if (æ‹‰ä¸è½‰å¯«.includes('wy')){
        const wy = {
            'wya': é¸é ….å°å‡åã‚ã‚‘ ? 'ğ›…ã‚ƒ' : 'ã‚ã‚„',
            'wyo': é¸é ….å°å‡åã‚ã‚‘ ? 'ğ›…ã‚‡' : 'ã‚ã‚ˆ'
        }
        return `${äº”åéŸ³[æ‹‰ä¸è½‰å¯«[0]]['u']}${wy[æ‹‰ä¸è½‰å¯«.slice(1, 4)]}ã†`;
    }

    // CVVCVâ†’CV.V.CVï¼šè¦‹https://stackoverflow.com/a/49407494/2719898
    const éŸ³ç¯€æ­£å‰‡ = /[^aeiou]*[wy]?[aeioumn](?:$|[^aeiou](?=[^aeiou]))?/gi;

    éŸ³ç¯€åˆ—è¡¨ = æ‹‰ä¸è½‰å¯«.match(éŸ³ç¯€æ­£å‰‡);

    å‡ååˆ—è¡¨ = éŸ³ç¯€åˆ—è¡¨.map((éŸ³ç¯€) => {
        if (éŸ³ç¯€.length == 3) {
            // CGV := CyV / CwV 
            let [C, G, V] = éŸ³ç¯€;

            const GtoV = {
                'y': 'i',
                'w': 'u'
            };

            if (C == '0')
                return äº”åéŸ³[G][V];
            if (å°å‡å[G][V] == 'â—‹')
                return äº”åéŸ³[C][V];
            if (!['k', 'g'].includes(C) && G == 'w')
                return äº”åéŸ³[C][V];

            return äº”åéŸ³[C][GtoV[G]] + å°å‡å[G][V];
        }

        const C = éŸ³ç¯€.length == 2 ? éŸ³ç¯€[0] : '0';
        const V = éŸ³ç¯€.slice(-1);

        if (V.match(/[aiueo]/)) {
            return äº”åéŸ³[C][V];
        } else if (V == 'n') {
            return 'ã‚“';
        } else if (V == 'm') {
            return 'ã‚€';
        } else {
            throw new Error(`æœªçŸ¥è¦å‰‡éŸ³ç¯€ï¼š ${éŸ³ç¯€}`);
        }
    })

    if (é¸é ….å°å‡åÅ‹å°¾ && Å‹) {
        å‡ååˆ—è¡¨[å‡ååˆ—è¡¨.length - 1] = å‡ååˆ—è¡¨[å‡ååˆ—è¡¨.length - 1] == 'ã†' ? 'ã…' : 'ãƒ'
    }

    return å‡ååˆ—è¡¨.join('');
}

const æ‹‰ä¸è½‰å¯« = çµ„åˆè²éŸ»(è²æ¯, éŸ»æ¯);

// return `${å‡ååŒ–(æ‹‰ä¸è½‰å¯«)}ï¼${æ‹‰ä¸è½‰å¯«.replace('0', '')}`
return é¸é ….å‡å ? å‡ååŒ–(æ‹‰ä¸è½‰å¯«) : æ‹‰ä¸è½‰å¯«.replace('0', '');
