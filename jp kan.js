/* æ¨å°æ—¥èªæ¼¢éŸ³èˆŠ
 *
 * ä»¥å­—éŸ³å‡åé£å½¢å¼è¡¨ç¤ºï¼Œæ‹—éŸ³ç”¨å°æ‡‰å°å‡åè¡¨ç¤ºï¼›æœ‰é¸é …å¯æ§åˆ¶ï¼šåˆ†mnå°¾ã€ã‚ã‚‘åˆæ‹—éŸ³ã€ã‚ã‚‘å°å‡åã€ç‹‚ï¼šã‚¯ğ›…¥ãƒ£ã‚¦ï¼ã‚­ãƒ£ã‚¦
 *
 * https://jgrammar.life.coocan.jp/ja/data/ksound.htm
 * https://ksu.repo.nii.ac.jp/record/1280/files/AHSUSK_HS_37_133.pdf
 *
 * å·²çŸ¥å•é¡Œï¼š
 * å†µ ã‚¯ãƒ°ãƒ£ã‚¦ ã‚­ãƒ£ã‚¦
 * çŸ ã‚¯ãƒ°ãƒ£ã‚¯ ã‚¯ãƒ®ã‚¯ â—‹ã€€ã‚­ãƒ£ã‚¯ âœ•
 * æ´« ã‚¯ãƒ°ãƒ§ã‚¯ ã‚­ãƒ§ã‚¯
 *
 */

/** @type { éŸ³éŸ»åœ°ä½['å±¬æ–¼'] } */
const is = (...x) => éŸ³éŸ»åœ°ä½.å±¬æ–¼(...x);
/** @type { éŸ³éŸ»åœ°ä½['åˆ¤æ–·'] } */
const when = (...x) => éŸ³éŸ»åœ°ä½.åˆ¤æ–·(...x);

// const é¸é … = {};
  // éŸ³è®Šè¦å‰‡
// é¸é ….ã‚ã‚‘ = true; // é–‹ï¼šã‚¯ğ›…¥ãƒ³ã€€é—œï¼šã‚±ãƒ³
// é¸é ….åˆ†mnå°¾ = true; // é–‹ï¼šã‚«ãƒ ã€€é—œï¼šã‚«ãƒ³
// é¸é ….å°å‡åÅ‹å°¾ = false; // é–‹ï¼šã‚«ã‚¥ã€€é—œï¼šã‚«ã‚¦
// é¸é ….kwyau = true; // é–‹ï¼šã‚¯ğ›…¥ãƒ£ã‚¦ã€€é—œï¼šã‚­ãƒ£ã‚¦
  // å‡åå¯«æ³•
// é¸é ….å‡å = true; // é–‹ï¼šã‚«ãƒ³ã€€é—œï¼škan
// é¸é ….å°å‡å = true; // é–‹ï¼šã‚­ãƒ£ã‚¦ã€€é—œï¼šã‚­ãƒ¤ã‚¦
// é¸é ….å°å‡åã‚ã‚‘ = true; // é–‹ï¼šã‚¯ğ›…¥ãƒ³ã€€é—œï¼šã‚¯ãƒ±ãƒ³
// if (!é¸é ….å°å‡å)
//    é¸é ….å°å‡åã‚ã‚‘ = false;

function è²æ¯è¦å‰‡() {
  return when([
    ['æ˜æ¯', [['å”é™½æ±éŸ»', 'b'], ['', 'm']]],
    ['è„£éŸ³', 'f'],

    ['æ³¥å­ƒæ¯', [['æ¢—æ”', 'n'], ['', 'd']]],
    ['ä¾†æ¯', 'r'],
    ['èˆŒéŸ³', 't'],

    ['æ—¥æ¯', 'z'],
    ['é½’éŸ³', 's'],

    ['ç–‘æ¯', 'g'],
    ['å½±äº‘ä»¥æ¯', '0'],
    ['ç‰™å–‰éŸ³', 'k'],
  ], 'ç„¡è²æ¯è¦å‰‡');
}

function éŸ»æ¯è¦å‰‡() {
  return when([
	// æœå‡æ”
    ['æœå‡æ” åˆå£', 'wa'],
    ['éº»éŸ» ä¸‰ç­‰', 'ya'],
    ['æœå‡æ”', 'a'],
	// é‡æ”
    ['æ¨¡éŸ»', [['å½±æ¯', 'wo'], ['', 'o']]], // æ±š wo
    ['é­šéŸ»', [['èŠçµ„', 'o'], ['', 'yo']]],
    ['è™éŸ»', [['å¹«è¦‹å½±çµ„', 'u'], ['çŸ¥çµ„', 'yuu'], ['', 'yu']]],
	// èŸ¹æ”
    ['ç¥­é½ŠéŸ»', [['åˆå£', 'wei'], ['', 'ei']]],
    ['èŸ¹æ”', [['åˆå£', 'wai'], ['', 'ai']]],
	// æ­¢æ”
    ['æ”¯è„‚éŸ» åˆå£ Aé¡', 'i'],
    ['æ­¢æ” åˆå£', [['èˆŒé½’éŸ³', 'ui'], ['ç‰™å–‰éŸ³', 'wi']]], // æ°´ ã™ã„ï½œé¡ ã‚‹ã„ï½œå° ã¤ã„
    ['æ­¢æ”', 'i'],
	// æ•ˆæ”
    ['è±ªéŸ» è„£éŸ³', 'ou'],
    ['è±ªè‚´éŸ»', 'au'],
    ['å®µè•­éŸ»', 'eu'],
	// æµæ”
    ['ä¾¯éŸ»', 'ou'],
    ['å°¤éŸ»', [['æ˜æ¯', 'ou'], ['è„£éŸ³', 'uu'], ['', 'iu']]],
    ['å¹½éŸ»', 'iu'],
	// å’¸æ”
    ['é¹½åš´æ·»éŸ»', 'em'],
    ['å’¸æ”', 'am'],
	// æ·±æ”
    ['æ·±æ”', 'im'],
	// å±±æ”
    ['å¯’åˆªå±±éŸ»', [['åˆå£', 'wan'], ['', 'an']]],
    ['å…ƒéŸ» è„£éŸ³', 'an'],
    ['å±±æ”', [['åˆå£', 'wen'], ['', 'en']]],
	// è‡»æ”
    ['ç—•é­‚éŸ»', 'on'],
    ['æ–‡éŸ»', 'un'],
    //['è«„éŸ» åˆå£ Aé¡', 'in'],
    //['è«„éŸ» åˆå£', [['ä¾†æ¯', 'in'], ['', 'yun']]],
    ['çœŸéŸ» åˆå£', 'win'],
    ['çœŸè‡»æ®·éŸ»', 'in'],
	// æ¢—æ”
    ['æ¢—æ” åˆå£ äºŒç­‰', 'waÅ‹'],
    ['åºšé’éŸ» åˆå£', 'weÅ‹'],
    ['æ¸…éŸ» åˆå£', 'yeÅ‹'],
    ['åºšéŸ» äºŒç­‰ (å¹«çŸ¥è¦‹çµ„ æˆ– åŒ£æ¯)', 'aÅ‹'],
    ['è€•éŸ»', 'aÅ‹'],
    ['åºšæ¸…é’éŸ»', 'eÅ‹'],
	// æ›¾æ”
    ['ç™»éŸ»', 'oÅ‹'],
    ['è’¸éŸ» åˆå£ (è¦‹çµ„ æˆ– å½±æ›‰æ¯)', 'wyoÅ‹'],
    ['è’¸éŸ» é–‹å£ èŠçµ„', 'oÅ‹'],
    ['è’¸éŸ»', 'yoÅ‹'],
	// å®•æ±Ÿæ”
    ['é™½éŸ» é–‹å£', [['èŠçµ„', 'aÅ‹'], ['', 'yaÅ‹']]],
    ['é™½éŸ» åˆå£', [['è¦‹çµ„ æˆ– å½±æ›‰æ¯', 'wyaÅ‹'], ['', 'waÅ‹']]],
    ['å®•æ±Ÿæ”', [['åˆå£', 'waÅ‹'], ['', 'aÅ‹']]],
	// é€šæ”
    ['æ±éŸ» ä¸€ç­‰ å½±æ¯', 'woÅ‹'], // ç¿ wou
    ['æ±å†¬éŸ» ä¸€ç­‰', 'oÅ‹'],
    ['é¾éŸ»', 'yoÅ‹'],
    ['æ±éŸ» è„£éŸ³', [['æ˜æ¯ æˆ– èˆ’è²','oÅ‹'], ['', 'uÅ‹']]],
    ['æ±éŸ» çŸ¥å½±çµ„', 'iÅ‹'],
    ['æ±éŸ» æ—¥ä¾†ä»¥æ¯', 'iÅ‹'],
    ['æ±éŸ» è¦‹çµ„ å…¥è²', 'iÅ‹'],
    ['æ±éŸ»', 'yuÅ‹'],
  ], 'ç„¡éŸ»æ¯è¦å‰‡');
}

let è²æ¯ = è²æ¯è¦å‰‡();
let éŸ»æ¯ = éŸ»æ¯è¦å‰‡();

// == éŸ»å°¾è¦å‰‡ ==

var Å‹ = false;

// å…¥è²éŸ»å°¾
if (is('å…¥è²')) {
    å…¥è²éŸ»å°¾ = {
        "m": 'fu',
        "n": 'tu',
        "Å‹": éŸ»æ¯[éŸ»æ¯.length - 2] == 'e' ? 'ki' : 'ku'
    }

    éŸ»æ¯ = éŸ»æ¯.slice(0, -1) + å…¥è²éŸ»å°¾[éŸ»æ¯.slice(-1)]
}

// é¼»éŸ³éŸ»å°¾åŒåŒ–é¼»éŸ³è²æ¯ï¼šNV > BVï½œNVN > NVNï¼›ä¾‹å¤–ï¼šèšŠ ã¶ã‚“ã€€NVN > NVN â†’ mun > bun
if (è²æ¯ == 'm' && (!éŸ»æ¯.endsWith('Å‹') || éŸ»æ¯.startsWith('u'))) è²æ¯ = 'b';

// å¾Œé¼»éŸ³éŸ»å°¾
if (éŸ»æ¯.endsWith('Å‹')) {
    éŸ»æ¯ = éŸ»æ¯.slice(0, -1) + (['e', 'i'].includes(éŸ»æ¯[éŸ»æ¯.length - 2]) ? 'i': 'u');
    Å‹ = true;
}

// == éŸ»é ­è¦å‰‡ ==
if (is('è„£éŸ³ ä¸‰ç­‰') && éŸ»æ¯.startsWith('y')) éŸ»æ¯ = éŸ»æ¯.slice(1); // PyV > PV
if (is('ä»¥æ¯ åˆå£') && éŸ»æ¯.startsWith('w')) éŸ»æ¯ = éŸ»æ¯.slice(1); // JwV > JV

// == éŸ»æ¯è¦å‰‡ ==
if (éŸ»æ¯ == 'ii') éŸ»æ¯ = 'yuu';

// TODOï¼šè½‰å‡åå‰æ•´ç†ç¾…é¦¬å­—

function çµ„åˆè²éŸ»(è²æ¯, éŸ»æ¯) {
    if (!["0", "k", "g"].includes(è²æ¯) && éŸ»æ¯.startsWith("w")) éŸ»æ¯ = éŸ»æ¯.slice(1);
    if (è²æ¯ == "0" && éŸ»æ¯.startsWith("ye")) éŸ»æ¯ = éŸ»æ¯.slice(1);
    if (!é¸é ….åˆ†mnå°¾ && éŸ»æ¯.endsWith("m")) éŸ»æ¯ = éŸ»æ¯.slice(0, -1) + "n";
    if (!é¸é ….ã‚ã‚‘ && è²æ¯ != "0") éŸ»æ¯ = éŸ»æ¯.replace("wy", "y").replace("wi", "i").replace("we", "e");
    return [è²æ¯, éŸ»æ¯].join("");
}

function å‡ååŒ–(æ‹‰ä¸è½‰å¯«) {
    const äº”åéŸ³ = {
        '0': {'a': 'ã‚', 'i': 'ã„', 'u': 'ã†', 'e': 'ãˆ', 'o': 'ãŠ'},
        'k': {'a': 'ã‹', 'i': 'ã', 'u': 'ã', 'e': 'ã‘', 'o': 'ã“'},
        'g': {'a': 'ãŒ', 'i': 'ã', 'u': 'ã', 'e': 'ã’', 'o': 'ã”'},
        's': {'a': 'ã•', 'i': 'ã—', 'u': 'ã™', 'e': 'ã›', 'o': 'ã'},
        'z': {'a': 'ã–', 'i': 'ã˜', 'u': 'ãš', 'e': 'ãœ', 'o': 'ã'},
        't': {'a': 'ãŸ', 'i': 'ã¡', 'u': 'ã¤', 'e': 'ã¦', 'o': 'ã¨'},
        'd': {'a': 'ã ', 'i': 'ã¢', 'u': 'ã¥', 'e': 'ã§', 'o': 'ã©'},
        'n': {'a': 'ãª', 'i': 'ã«', 'u': 'ã¬', 'e': 'ã­', 'o': 'ã®'},
        'f': {'a': 'ã¯', 'i': 'ã²', 'u': 'ãµ', 'e': 'ã¸', 'o': 'ã»'},
        'b': {'a': 'ã°', 'i': 'ã³', 'u': 'ã¶', 'e': 'ã¹', 'o': 'ã¼'},
        'm': {'a': 'ã¾', 'i': 'ã¿', 'u': 'ã‚€', 'e': 'ã‚', 'o': 'ã‚‚'},
        'y': {'a': 'ã‚„', 'i': 'â—‹', 'u': 'ã‚†', 'e': 'ãˆ', 'o': 'ã‚ˆ'},
        'r': {'a': 'ã‚‰', 'i': 'ã‚Š', 'u': 'ã‚‹', 'e': 'ã‚Œ', 'o': 'ã‚'},
        'w': {'a': 'ã‚', 'i': 'ã‚', 'u': 'â—‹', 'e': 'ã‚‘', 'o': 'ã‚’'},
    };

    let [wi, we] = é¸é ….å°å‡åã‚ã‚‘ ? ['ğ›…', 'ğ›…‘'] : ['ã‚', 'ã‚‘'];

    const å°å‡å = {
        'y': {'a': 'ã‚ƒ', 'i': 'â—‹', 'u': 'ã‚…', 'e': 'â—‹', 'o': 'ã‚‡'},
        'w': {'a': 'ã‚', 'i': wi, 'u': 'â—‹', 'e': we, 'o': 'ğ›…’'},
    };

    if (!é¸é ….å°å‡å) {
        å°å‡å['y'] = äº”åéŸ³['y'];
        å°å‡å['w'] = äº”åéŸ³['w'];
    }

    // äºŒåˆæ‹—éŸ³ï¼šwiyau > ğ›…ã‚ƒã†
    if (æ‹‰ä¸è½‰å¯«.includes("wy")){
        const wy = {
            "wya": é¸é ….å°å‡åã‚ã‚‘ ? 'ğ›…ã‚ƒ' : 'ã‚ã‚„',
            "wyo": é¸é ….å°å‡åã‚ã‚‘ ? 'ğ›…ã‚‡' : 'ã‚ã‚ˆ'
        }
        return `${äº”åéŸ³[æ‹‰ä¸è½‰å¯«[0]]['u']}${wy[æ‹‰ä¸è½‰å¯«.slice(1, 4)]}ã†`;
    }

    // CVVCV > CV.V.CVï¼šè¦‹https://stackoverflow.com/a/49407494/2719898
    const éŸ³ç¯€æ­£å‰‡ = /[^aeiou]*[wy]?[aeioumn](?:$|[^aeiou](?=[^aeiou]))?/gi;

    éŸ³ç¯€åˆ—è¡¨ = æ‹‰ä¸è½‰å¯«.match(éŸ³ç¯€æ­£å‰‡);

    å‡ååˆ—è¡¨ = éŸ³ç¯€åˆ—è¡¨.map((éŸ³ç¯€) => {
        if (éŸ³ç¯€.length == 3) {
            // CGV := CyV / CwV 
            let [C, G, V] = éŸ³ç¯€;

            const GtoV = {
                'y': 'i',
                'w': 'u'
            };

            if (C == '0')
                return äº”åéŸ³[G][V];
            if (å°å‡å[G][V] == 'â—‹')
                return äº”åéŸ³[C][V];
            if (!['k', 'g'].includes(C) && G == 'w')
                return äº”åéŸ³[C][V];

            return äº”åéŸ³[C][GtoV[G]] + å°å‡å[G][V];
        }

        const C = éŸ³ç¯€.length == 2 ? éŸ³ç¯€[0] : '0';
        const V = éŸ³ç¯€.slice(-1);

        if (V.match(/[aiueo]/)) {
            return äº”åéŸ³[C][V];
        } else if (V == 'n') {
            return 'ã‚“';
        } else if (V == 'm') {
            return 'ã‚€';
        } else {
            throw new Error(`æœªçŸ¥è¦å‰‡éŸ³ç¯€ï¼š ${éŸ³ç¯€}`);
        }
    })

    if (é¸é ….å°å‡åÅ‹å°¾ && Å‹) {
        å‡ååˆ—è¡¨[å‡ååˆ—è¡¨.length - 1] = å‡ååˆ—è¡¨[å‡ååˆ—è¡¨.length - 1] == "ã†" ? "ã…" : "ãƒ"
    }

    return å‡ååˆ—è¡¨.join('');
}

const æ‹‰ä¸è½‰å¯« = çµ„åˆè²éŸ»(è²æ¯, éŸ»æ¯);

// return `${å‡ååŒ–(æ‹‰ä¸è½‰å¯«)} (${æ‹‰ä¸è½‰å¯«.replace("0", "")})`
return é¸é ….å‡å ? å‡ååŒ–(æ‹‰ä¸è½‰å¯«) : æ‹‰ä¸è½‰å¯«.replace("0", "");
